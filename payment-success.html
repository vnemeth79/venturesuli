<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sikeres fizetés - Venturesuli</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <!-- Barion Pixel -->
    <script>(function(i,s,o,g,r,a,m){i['BarionAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://pixel.barion.com/bp.js','bp');bp('init', 'BP-FIg57XD9SG-D1');window.addEventListener('load', function() { bp('track', 'pageview'); });</script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            padding: 20px;
        }
        .container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        .logo {
            height: 80px;
            margin-bottom: 20px;
        }
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        h1 {
            color: #4ade80;
            margin-bottom: 20px;
        }
        p {
            color: #ddd;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #fbbf24;
        }
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fbbf24;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1a1a2e;
            padding: 15px 40px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-top: 20px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
        }
        .error {
            color: #ef4444;
        }
        footer {
            margin-top: 40px;
            text-align: center;
            color: #888;
            font-size: 0.9em;
        }
        footer a {
            color: #fbbf24;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="venturesuli-logo.png" alt="Venturesuli Logo" class="logo">
        <div id="status-container">
            <div class="loading">
                <div class="spinner"></div>
                <span>Fizetés ellenőrzése...</span>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2024 Progile Tanácsadó Kft. | <a href="aszf.html" target="_blank">ÁSZF</a> | <a href="adatvedelem.html" target="_blank">Adatvédelem</a></p>
    </footer>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCbHoaU_uZrFvZv2W3wMbV3P4FaZLE10Z0",
            authDomain: "venturesuli.firebaseapp.com",
            projectId: "venturesuli",
            storageBucket: "venturesuli.firebasestorage.app",
            messagingSenderId: "346873977498",
            appId: "1:346873977498:web:64ab96e5acb2cc1edc82e6"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        async function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const paymentId = urlParams.get('paymentId');
            const userId = urlParams.get('userId');
            
            const statusContainer = document.getElementById('status-container');

            try {
                // Wait a moment for callback to process
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Check if user is logged in
                const user = auth.currentUser;
                if (!user && !userId) {
                    statusContainer.innerHTML = `
                        <div class="error">
                            <h1>⚠️</h1>
                            <h2>Bejelentkezés szükséges</h2>
                            <p>Kérjük, jelentkezzen be a fizetés állapotának ellenőrzéséhez.</p>
                            <a href="auth.html" class="btn">Bejelentkezés</a>
                        </div>
                    `;
                    return;
                }

                const checkUserId = user?.uid || userId;

                // Check Firestore for payment status
                const userDoc = await db.collection('users').doc(checkUserId).get();
                
                if (userDoc.exists && userDoc.data().hasPaid) {
                    // Payment successful!
                    statusContainer.innerHTML = `
                        <div class="success-icon">✅</div>
                        <h1>Sikeres fizetés!</h1>
                        <p>Köszönjük a vásárlást! A Venturesuli tanfolyam most már elérhető számodra.</p>
                        <p>A számlát hamarosan megkapod e-mailben.</p>
                        <a href="app.html" class="btn">Tanfolyam megnyitása</a>
                    `;
                    
                    // Track successful purchase with Barion Pixel
                    if (typeof bp !== 'undefined') {
                        bp('track', 'purchase', {
                            currency: 'HUF',
                            value: 11111
                        });
                    }
                } else {
                    // Payment not confirmed yet or failed
                    statusContainer.innerHTML = `
                        <div class="success-icon">⏳</div>
                        <h1>Fizetés feldolgozás alatt</h1>
                        <p>A fizetés még feldolgozás alatt áll. Kérjük, várjon néhány percet, majd próbálja újra.</p>
                        <p>Ha a probléma továbbra is fennáll, kérjük, lépjen kapcsolatba velünk: nvalentin@progile.eu</p>
                        <a href="payment.html" class="btn">Vissza a fizetéshez</a>
                    `;
                }
            } catch (error) {
                console.error('Error checking payment:', error);
                statusContainer.innerHTML = `
                    <div class="error">
                        <h1>⚠️</h1>
                        <h2>Hiba történt</h2>
                        <p>A fizetés ellenőrzése során hiba történt. Kérjük, próbálja újra később.</p>
                        <a href="payment.html" class="btn">Vissza a fizetéshez</a>
                    </div>
                `;
            }
        }

        // Check auth state and then payment
        auth.onAuthStateChanged((user) => {
            checkPaymentStatus();
        });
    </script>
</body>
</html>
